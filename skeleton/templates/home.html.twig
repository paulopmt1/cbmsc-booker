<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Sincronizar Planilhas{% endblock %}</title>
        <link rel="icon" href="images/fogo.png">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        {% block stylesheets %}
            <link rel="stylesheet" href="{{ asset('style/home.css') }}?v={{ "now"|date('U') }}">
        {% endblock %}

        {% block javascripts %}
            <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        {% endblock %}
    </head>
    <header>
        <div class="logo-container">
            <img src="{{ asset('images/bombeiro-150.png') }}" alt="logo">
            <span>Olá, bombeiro!</span>
        </div>
    </header>
    <body>
        {% block body %}
            <form action="{{ path('home_page') }}" method="post">
                <div class="form-group">
                    <label for="sheetId">Planilha da Escolha de Horários</label>
                    <input type="text" id="sheetId" name="sheetId" value="{{ sheetId|default('') }}">
                </div>

                <div class="form-group">
                    <label for="sheetIdB">Planilha Preliminar</label>
                    <input type="text" id="sheetIdB" name="sheetIdB" value="{{ sheetIdB|default('') }}">
                </div>

                <div class="form-group">
                    <label for="cotasPorDia">Cotas por dia (geralmente 2,5)</label>
                    <input type="number" value="2.5" id="cotasPorDia" name="cotasPorDia" value="{{ cotasPorDia|default('') }}" step="any">
                </div>

                <div class="form-group">
                    <label for="diasMotorista">Quais dias precisamos de motorista?</label>
                    <input type="text" id="diasMotorista" name="diasMotorista" placeholder="Selecione os dias" readonly>
                    <input type="hidden" id="diasMotoristaHidden" name="diasMotoristaHidden" value="{{ diasMotorista|default('') }}">
                </div>

                <div class="form-group">
                    <label>Tipo de processamento</label>
                    <div class="toggle-container">
                        <span class="toggle-label {% if tipoProcessamento|default('algoritmo') == 'simples' %}active{% endif %}">Conversão simples</span>
                        <label class="toggle-switch">
                            <input type="checkbox" name="tipoProcessamento" value="algoritmo" {% if tipoProcessamento|default('algoritmo') == 'algoritmo' %}checked{% endif %}>
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label {% if tipoProcessamento|default('algoritmo') == 'algoritmo' %}active{% endif %}">Processar com Algoritmo</span>
                    </div>
                </div>

                <input type="submit" value="SINCRONIZAR" class="submit-btn">
                <br><br>
                <div>
                    {% for message in app.flashes('success') %}
                        <div class="alert alert-success">{{ message }}</div>
                    {% endfor %}

                    {% for message in app.flashes('error') %}
                        <div class="alert alert-danger">{{ message }}</div>
                    {% endfor %}
                    
                    {% if app.environment == 'dev' %}
                        {% for message in app.flashes('dev_error') %}
                            <div class="dev-error-content">
                                <div class="alert alert-danger">{{ message }}</div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </form>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const diasMotoristaInput = document.getElementById('diasMotorista');
                    const diasMotoristaHidden = document.getElementById('diasMotoristaHidden');
                    
                    // Initialize Flatpickr with multiple date selection
                    const flatpickrInstance = flatpickr(diasMotoristaInput, {
                        mode: "multiple",
                        dateFormat: "d/m/Y",
                        locale: {
                            firstDayOfWeek: 1,
                            weekdays: {
                                shorthand: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S�b'],
                                longhand: ['Domingo', 'Segunda-feira', 'Ter�a-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S�bado']
                            },
                            months: {
                                shorthand: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                                longhand: ['Janeiro', 'Fevereiro', 'Mar�o', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro']
                            }
                        },
                        allowInput: false,
                        onChange: function(selectedDates, dateStr, instance) {
                            // Store selected dates as comma-separated string in hidden input
                            const datesArray = selectedDates.map(date => {
                                const day = String(date.getDate()).padStart(2, '0');
                                const month = String(date.getMonth() + 1).padStart(2, '0');
                                const year = date.getFullYear();
                                return `${year}-${month}-${day}`;
                            });
                            diasMotoristaHidden.value = datesArray.join(',');
                        }
                    });

                    // If there's a pre-existing value, parse and set it
                    if (diasMotoristaHidden.value) {
                        const dates = diasMotoristaHidden.value.split(',');
                        const parsedDates = dates.map(dateStr => {
                            const [year, month, day] = dateStr.split('-');
                            return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                        });
                        flatpickrInstance.setDate(parsedDates, false);
                    }

                    // Toggle switch label highlighting
                    const toggleSwitch = document.querySelector('.toggle-switch input');
                    const toggleLabels = document.querySelectorAll('.toggle-label');
                    
                    function updateToggleLabels() {
                        if (toggleSwitch.checked) {
                            toggleLabels[0].classList.remove('active');
                            toggleLabels[1].classList.add('active');
                        } else {
                            toggleLabels[0].classList.add('active');
                            toggleLabels[1].classList.remove('active');
                        }
                    }
                    
                    toggleSwitch.addEventListener('change', updateToggleLabels);
                });
            </script>

        {% endblock %}
    </body>
</html>